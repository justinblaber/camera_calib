function [calib,calib_raw] = parse_single_calib(calib_raw,suffix)
    % Helper function to parse a single calibration from input raw 
    % calibration struct. Note that calib.config is not parsed out of
    % calib_raw. 
    %
    % Inputs:
    %   calib_raw - struct; raw calibration read from file. This needs to
    %       be parsed and formatted.
    %   suffix - string; optional suffix added to names.
    %
    % Outputs:
    %   calib - struct; contains:
    %       .intrin.A - array; optimized camera matrix
    %       .intrin.distortion - array; optimized distortions (radial and
    %           tangential) stored as: 
    %           [beta1; beta2; beta3; beta4]  
    %       .extrin(i).cb_img - class.img; ith calibration board image
    %       .extrin(i).rotation - array; ith optimized rotation
    %       .extrin(i).translation - array; ith optimized translation
    %       .extrin(i).board_points_p - array; ith array of optimized 
    %           subpixel calibration board points in pixel coordinates.
    %       .extrin(i).debug.homography_refine - array; ith homography used
    %           for subpixel checkerboard corner refinement.
    %   calib_raw - struct; remainder after parsing out single calibration
                   
    % TODO: add checks for validation
    
    if ~exist('suffix','var')
        suffix = '';
    end
    
    % Intrinsics ---------------------------------------------------------%
    [calib.intrin.A, calib_raw] = read_and_remove(calib_raw,['A' suffix]);    
    [calib.intrin.distortion, calib_raw] = read_and_remove(calib_raw,['distortion' suffix]);
    
    % Extrinsics ---------------------------------------------------------%
    % Read everything
    [cb_img_paths, calib_raw] = read_and_remove(calib_raw,['cb_img' suffix]);
    cb_img_paths = cell_check(cb_img_paths);
    [rotations, calib_raw] = read_and_remove(calib_raw,['rotation' suffix]);
    rotations = cell_check(rotations);    
    [translations, calib_raw] = read_and_remove(calib_raw,['translation' suffix]);
    translations = cell_check(translations);
    [board_points_ps, calib_raw] = read_and_remove(calib_raw,['board_points_p' suffix]);
    board_points_ps = cell_check(board_points_ps); 
    [four_points_ps, calib_raw] = read_and_remove(calib_raw,['four_points_p' suffix]);
    four_points_ps = cell_check(four_points_ps);   
    [homographies_refine, calib_raw] = read_and_remove(calib_raw,['homographies_refine' suffix]);
    homographies_refine = cell_check(homographies_refine);
end

function [param, calib] = read_and_remove(calib,field)
    param = calib.(field);
    calib = rmfield(calib,field);
end

function param = cell_check(param)
    if ~iscell(param)
        param = {param};
    end
end