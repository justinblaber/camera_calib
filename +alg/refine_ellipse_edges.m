function [e, cov_e] = refine_ellipse_edges(array_dx,array_dy,e_init,opts)
    % Performs "edges" refinement of an ellipse.
    %
    % Inputs:
    %   array_dx - array; MxN array gradient in x direction
    %   array_dy - array; MxN array gradient in y direction
    %   e_init - array; 5x1 initial guess for ellipse matrix stored as:
    %       e(1) = h; x component of center of ellipse
    %       e(2) = k; y component of center of ellipse
    %       e(3) = a; major axis length 
    %       e(4) = b; minor axis length
    %       e(5) = alpha; rotation of major axis
    %   opts - struct;
    %       .refine_ellipse_edges_h2_init - scalar; initial value of h2
    %           parameter in "edges" ellipse refinement
    %       .refine_ellipse_edges_it_cutoff - int; max number of 
    %           iterations performed for "edges" ellipse refinement 
    %       .refine_ellipse_edges_norm_cutoff - scalar; cutoff for the 
    %           difference in norm of the parameter vector for "edges" 
    %           ellipse refinement
    %
    % Outputs:
    %   e - array; 5x1 refined ellipse matrix stored as:
    %       e(1) = h; x component of center of ellipse
    %       e(2) = k; y component of center of ellipse
    %       e(3) = a; major axis length 
    %       e(4) = b; minor axis length
    %       e(5) = alpha; rotation of major axis
    %   cov_e - array; 5x5 covariance array
        
    if ~isequal(size(array_dx),size(array_dy))
        error('Input gradient arrays must be equal in size');
    end
        
    % Get coordinates of pixels
    [y,x] = ndgrid(1:size(array_dx,1),1:size(array_dx,2));
    x = x(:);
    y = y(:);
                
    % Get gradient magnitude
    array_grad_mag = sqrt(array_dx.^2 + array_dy.^2);
    
    % Normalize gradient magnitude between 0 and 1
    array_grad_mag = (array_grad_mag-min(array_grad_mag(:)))./(max(array_grad_mag(:))-min(array_grad_mag(:)));
        
    % Create initial parameter vector
    h = [1;
         opts.refine_ellipse_edges_h2_init;
    	 e_init];
    
    % Perform iterations until convergence
    for it = 1:opts.refine_ellipse_edges_it_cutoff  
        % Get gauss newton parameters
        [hess, grad] = get_gauss_newton_params(h, ...
                                               array_grad_mag, ...
                                               x, ...
                                               y);

        % Get and store update
        delta_h = -mldivide(hess,grad);
        h = h + delta_h;        
         
        % Exit if change in distance is small
        if norm(delta_h) < opts.refine_ellipse_edges_norm_cutoff
            break
        end        
    end
        
    % Get ellipse
    e = h(3:7);    

    % Get covariance of center point
    [hess, ~, r] = get_gauss_newton_params(h, ...
                                           array_grad_mag, ...
                                           x, ...
                                           y);
    mse = r'*r/(numel(r)-numel(h));
    cov_e = inv(hess)*mse; %#ok<MINV>
    cov_e = cov_e(3:7,3:7);
end

function [hess, grad, r] = get_gauss_newton_params(h,array_grad_mag,x,y)
    % Sample edge function        
    f = h(1).*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2);
    
    % Get residuals
    r = f-array_grad_mag(:);

    % Get gradient of edge function
    df_dh = [(exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2))';
             (-2.*h(1).*h(2).*exp(-h(2).^2.*(((h(3) - x).^2 + (h(4) - y).^2).^(1./2) - (h(5).*h(6).*((h(3).^2.*h(6).^2.*cos(h(7)).^2 + h(4).^2.*h(5).^2.*cos(h(7)).^2 + h(3).^2.*h(5).^2.*sin(h(7)).^2 + h(4).^2.*h(6).^2.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - h(3).*h(4).*h(5).^2.*sin(2.*h(7)) + h(3).*h(4).*h(6).^2.*sin(2.*h(7)) - 2.*h(3).*h(6).^2.*x.*cos(h(7)).^2 - 2.*h(4).*h(5).^2.*y.*cos(h(7)).^2 + h(4).*h(5).^2.*x.*sin(2.*h(7)) - h(4).*h(6).^2.*x.*sin(2.*h(7)) - 2.*h(3).*h(5).^2.*x.*sin(h(7)).^2 + h(3).*h(5).^2.*y.*sin(2.*h(7)) - h(3).*h(6).^2.*y.*sin(2.*h(7)) - 2.*h(4).*h(6).^2.*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(3).^2.*h(6).^2.*cos(h(7)).^2 + h(4).^2.*h(5).^2.*cos(h(7)).^2 + h(3).^2.*h(5).^2.*sin(h(7)).^2 + h(4).^2.*h(6).^2.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - h(3).*h(4).*h(5).^2.*sin(2.*h(7)) + h(3).*h(4).*h(6).^2.*sin(2.*h(7)) - 2.*h(3).*h(6).^2.*x.*cos(h(7)).^2 - 2.*h(4).*h(5).^2.*y.*cos(h(7)).^2 + h(4).*h(5).^2.*x.*sin(2.*h(7)) - h(4).*h(6).^2.*x.*sin(2.*h(7)) - 2.*h(3).*h(5).^2.*x.*sin(h(7)).^2 + h(3).*h(5).^2.*y.*sin(2.*h(7)) - h(3).*h(6).^2.*y.*sin(2.*h(7)) - 2.*h(4).*h(6).^2.*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(((h(3) - x).^2 + (h(4) - y).^2).^(1./2) - (h(5).*h(6).*((h(3).^2.*h(6).^2.*cos(h(7)).^2 + h(4).^2.*h(5).^2.*cos(h(7)).^2 + h(3).^2.*h(5).^2.*sin(h(7)).^2 + h(4).^2.*h(6).^2.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - h(3).*h(4).*h(5).^2.*sin(2.*h(7)) + h(3).*h(4).*h(6).^2.*sin(2.*h(7)) - 2.*h(3).*h(6).^2.*x.*cos(h(7)).^2 - 2.*h(4).*h(5).^2.*y.*cos(h(7)).^2 + h(4).*h(5).^2.*x.*sin(2.*h(7)) - h(4).*h(6).^2.*x.*sin(2.*h(7)) - 2.*h(3).*h(5).^2.*x.*sin(h(7)).^2 + h(3).*h(5).^2.*y.*sin(2.*h(7)) - h(3).*h(6).^2.*y.*sin(2.*h(7)) - 2.*h(4).*h(6).^2.*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(3).^2.*h(6).^2.*cos(h(7)).^2 + h(4).^2.*h(5).^2.*cos(h(7)).^2 + h(3).^2.*h(5).^2.*sin(h(7)).^2 + h(4).^2.*h(6).^2.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - h(3).*h(4).*h(5).^2.*sin(2.*h(7)) + h(3).*h(4).*h(6).^2.*sin(2.*h(7)) - 2.*h(3).*h(6).^2.*x.*cos(h(7)).^2 - 2.*h(4).*h(5).^2.*y.*cos(h(7)).^2 + h(4).*h(5).^2.*x.*sin(2.*h(7)) - h(4).*h(6).^2.*x.*sin(2.*h(7)) - 2.*h(3).*h(5).^2.*x.*sin(h(7)).^2 + h(3).*h(5).^2.*y.*sin(2.*h(7)) - h(3).*h(6).^2.*y.*sin(2.*h(7)) - 2.*h(4).*h(6).^2.*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2)'; 
             (-2.*h(1).*h(2).^2.*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).*((h(3) - x)./((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(2.*h(3) - 2.*x))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7))) + (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2).*(2.*h(6).^2.*h(3).*cos(h(7)).^2 + 2.*h(5).^2.*h(3).*sin(h(7)).^2 - 2.*h(6).^2.*x.*cos(h(7)).^2 - h(5).^2.*h(4).*sin(2.*h(7)) + h(6).^2.*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*x.*sin(h(7)).^2 + h(5).^2.*y.*sin(2.*h(7)) - h(6).^2.*y.*sin(2.*h(7))))./(h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2).^2 - (h(5).*h(6).*(h(5).^2 - h(6).^2).*(h(4) - y).*(sin(2.*h(7)).*h(3).^2 - 2.*cos(2.*h(7)).*h(3).*h(4) - 2.*sin(2.*h(7)).*h(3).*x + 2.*cos(2.*h(7)).*h(3).*y - sin(2.*h(7)).*h(4).^2 + 2.*cos(2.*h(7)).*h(4).*x + 2.*sin(2.*h(7)).*h(4).*y + sin(2.*h(7)).*x.^2 - 2.*cos(2.*h(7)).*x.*y - sin(2.*h(7)).*y.^2))./(2.*((h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2)./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2).*(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7))))))';
             (-2.*h(1).*h(2).^2.*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).*((h(4) - y)./((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*(2.*h(4) - 2.*y).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7))) + (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2).*(2.*h(5).^2.*h(4).*cos(h(7)).^2 - h(5).^2.*h(3).*sin(2.*h(7)) + h(6).^2.*h(3).*sin(2.*h(7)) - 2.*h(5).^2.*y.*cos(h(7)).^2 + 2.*h(6).^2.*h(4).*sin(h(7)).^2 + h(5).^2.*x.*sin(2.*h(7)) - h(6).^2.*x.*sin(2.*h(7)) - 2.*h(6).^2.*y.*sin(h(7)).^2))./(h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2).^2 + (h(5).*h(6).*(h(5).^2 - h(6).^2).*(h(3) - x).*(sin(2.*h(7)).*h(3).^2 - 2.*cos(2.*h(7)).*h(3).*h(4) - 2.*sin(2.*h(7)).*h(3).*x + 2.*cos(2.*h(7)).*h(3).*y - sin(2.*h(7)).*h(4).^2 + 2.*cos(2.*h(7)).*h(4).*x + 2.*sin(2.*h(7)).*h(4).*y + sin(2.*h(7)).*x.^2 - 2.*cos(2.*h(7)).*x.*y - sin(2.*h(7)).*y.^2))./(2.*((h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2)./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2).*(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7))))))';
             ((2.*h(6).^3.*h(1).*h(2).^2.*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).*(h(3).^2.*cos(h(7)).^2 + x.^2.*cos(h(7)).^2 + h(4).^2.*sin(h(7)).^2 + y.^2.*sin(h(7)).^2 - 2.*h(3).*x.*cos(h(7)).^2 + h(3).*h(4).*sin(2.*h(7)) - h(3).*y.*sin(2.*h(7)) - h(4).*x.*sin(2.*h(7)) - 2.*h(4).*y.*sin(h(7)).^2 + x.*y.*sin(2.*h(7))))./(((h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2)./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))))';
             ((2.*h(5).^3.*h(1).*h(2).^2.*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).*(h(4).^2.*cos(h(7)).^2 + h(3).^2.*sin(h(7)).^2 + y.^2.*cos(h(7)).^2 + x.^2.*sin(h(7)).^2 - h(3).*h(4).*sin(2.*h(7)) - 2.*h(4).*y.*cos(h(7)).^2 - 2.*h(3).*x.*sin(h(7)).^2 + h(3).*y.*sin(2.*h(7)) + h(4).*x.*sin(2.*h(7)) - x.*y.*sin(2.*h(7))))./(((h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2)./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))))';
             (-(2.*h(5).*h(6).*h(1).*h(2).^2.*exp(-h(2).^2.*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).^2).*(h(5).^2 - h(6).^2).*(((h(4) - y).^2 + (h(3) - x).^2).^(1./2) - (h(5).*h(6).*((h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2))./(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))).*((h(3).^2.*sin(2.*h(7)))./2 - (h(4).^2.*sin(2.*h(7)))./2 + (x.^2.*sin(2.*h(7)))./2 - (y.^2.*sin(2.*h(7)))./2 - h(3).*h(4).*cos(2.*h(7)) + h(3).*y.*cos(2.*h(7)) + h(4).*x.*cos(2.*h(7)) - h(3).*x.*sin(2.*h(7)) - x.*y.*cos(2.*h(7)) + h(4).*y.*sin(2.*h(7))))./(((h(5).^2.*h(3).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*h(3).*h(4) - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(3).*y + h(5).^2.*h(4).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(5).^2.*h(4).*x - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(5).^2.*x.*y + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*h(3).^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*h(3).*h(4) - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(3).*y + h(6).^2.*h(4).^2.*sin(h(7)).^2 - sin(2.*h(7)).*h(6).^2.*h(4).*x - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + sin(2.*h(7)).*h(6).^2.*x.*y + h(6).^2.*y.^2.*sin(h(7)).^2)./(h(3).^2 - 2.*h(3).*x + h(4).^2 - 2.*h(4).*y + x.^2 + y.^2)).^(1./2).*(h(6).^2.*h(3).^2.*cos(h(7)).^2 + h(5).^2.*h(4).^2.*cos(h(7)).^2 + h(5).^2.*h(3).^2.*sin(h(7)).^2 + h(5).^2.*y.^2.*cos(h(7)).^2 + h(6).^2.*x.^2.*cos(h(7)).^2 + h(6).^2.*h(4).^2.*sin(h(7)).^2 + h(5).^2.*x.^2.*sin(h(7)).^2 + h(6).^2.*y.^2.*sin(h(7)).^2 - 2.*h(6).^2.*h(3).*x.*cos(h(7)).^2 - h(5).^2.*h(3).*h(4).*sin(2.*h(7)) + h(6).^2.*h(3).*h(4).*sin(2.*h(7)) - 2.*h(5).^2.*h(4).*y.*cos(h(7)).^2 - 2.*h(5).^2.*h(3).*x.*sin(h(7)).^2 + h(5).^2.*h(3).*y.*sin(2.*h(7)) - h(6).^2.*h(3).*y.*sin(2.*h(7)) + h(5).^2.*h(4).*x.*sin(2.*h(7)) - h(6).^2.*h(4).*x.*sin(2.*h(7)) - 2.*h(6).^2.*h(4).*y.*sin(h(7)).^2 - h(5).^2.*x.*y.*sin(2.*h(7)) + h(6).^2.*x.*y.*sin(2.*h(7)))))'];

    % Get cost function gradient and hessian
    grad = 2*sum(r'.*df_dh,2);
    hess = 2*(df_dh*df_dh');
end